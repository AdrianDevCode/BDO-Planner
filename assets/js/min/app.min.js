/*
* @Author: SirMrE
* @http: http://www.sirmre.com/bdo-calculator
* @Copyright: (c) 2016 Mark Eliasen
* @license: May be freely distributed under the CC BY-NC 3.0 License 
*           (https://creativecommons.org/licenses/by-nc/3.0/)
* @Date:   2016-04-07 20:53:22
* @Last Modified by:   SirMrE
* @Last Modified time: 2016-04-14 02:33:05
*/
!function($){"use strict";function e(e){var t=Object.keys(e.enhancement).length;return t>0&&t>BDOdatabase.max_gear_enhancement&&(t=BDOdatabase.max_gear_enhancement),t}function t(e){return e.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()})}function a(e,t){$("#equipment .gear-slot[data-type='"+e+"']"+("undefined"==typeof t?"":"[data-item='"+t+"']")).attr("style",""),$("#equipment .gem-slot."+e+"1, .gem-slot."+e+"2").attr("style","").hide()}function s(e,t,a,s){if("gems"!==s?$("#equipment .gear-slot[data-type='"+t+"']"+("undefined"===a?"":"[data-item='"+a+"']")).css({"border-color":BDOdatabase.rarities[e.rarity],background:"url(assets/images/48/"+(-1===$.inArray(t,["main-weapon","secondary-weapon"])?t:BDOdatabase.class_weapons[d][t].replace(" ","-").toLowerCase())+".png) no-repeat center center"}):$("#equipment .gem-slot[data-type='"+t+"'][data-item='"+a+"']").css({"border-color":BDOdatabase.rarities[e.rarity]}),-1!==$.inArray(t,["main-weapon","secondary-weapon","armor","shoes","gloves","helmet"])&&"gems"!==s&&($("#equipment .gem-slot."+t+"1, #equipment .gem-slot."+t+"2").hide(),e.gems>0))for(var i,n=e.gems;n>0;n--)""!==BDOcalculator.gear[t].gems[n].gem_name?(i=BDOcalculator.gear[t].gems[n].gem,$("#equipment .gem-slot."+t+n).css({"border-color":BDOdatabase.rarities[i.rarity]}).show()):$("#equipment .gem-slot."+t+n).attr("style","").show()}function i(e,t,a,s,i,n){i="undefined"==typeof i?1:i;var d=$('<div class="item-details '+(n?" selected ":"")+"col-md-10 col-md-offset-"+(i%2===0?"2":"1")+'"/>'),r;if(d.append('<div class="item-name"><strong style="color: '+BDOdatabase.rarities[e.rarity]+'">'+s+"</strong></div>"),d.append('<div class="item-icon"><img src="assets/images/48/gem.png" alt="BDO Gear Calculator"></div>'),d.append('<button class="btn btn-sm btn-primary item-choose" data-item="'+s+'" data-itemset="gems" data-type="'+t+'" data-itemno="'+a+'">Choose</button>'),r=$('<div class="item-effects"/>'),r.append("<strong>Item Effects</strong>"),Object.keys(e.item_effects).length>0)for(var o in e.item_effects)e.item_effects.hasOwnProperty(o)&&("special"===o?r.append("<strong>"+BDOdatabase.stats[o].title+":</strong><div>"+e.item_effects.special+"</div>"):r.append("<div>"+BDOdatabase.stats[o].title+" "+e.item_effects[o]+BDOdatabase.stats[o].symbol+"</div>"));else r.append("<div>None.</div>");if(r.appendTo(d),e.incompatible.length>0){r=$('<div class="item-effects"/>'),r.append("<strong>It doesn't stack with:</strong>");for(var c=e.incompatible.length-1;c>=0;c--)r.append("<div>"+e.incompatible[c]+"</div>");r.appendTo(d)}return d}function n(a,s,i,n,r,o,c){o="undefined"==typeof o?1:o;var l=$('<div class="item-details '+(c?" selected ":"")+"col-md-10 col-md-offset-"+(o%2===0?"2":"1")+'"/>'),p,m=0;if(-1!==$.inArray(s,["ring","earring"])?BDOcalculator.gear[s+"s"][n].item_name===r&&(m=BDOcalculator.gear[s+"s"][n].enhancement):BDOcalculator.gear[s].item_name===r&&(m=BDOcalculator.gear[s].enhancement),l.append('<div class="item-name"><strong style="color: '+BDOdatabase.rarities[a.rarity]+'">'+r+"</strong></div>"),l.append('<div class="item-icon"><img src="assets/images/48/'+(-1===$.inArray(s,["main-weapon","secondary-weapon"])?s:BDOdatabase.class_weapons[d][s].replace(" ","-").toLowerCase())+'.png" alt="BDO Gear Calculator"></div>'),p=$('<div class="item-stats"/>'),"undefined"!=typeof a.ap&&p.append("<div>AP: "+BDOcalculator.getItemStat(a,"ap",!1,m)+"</div>"),"undefined"!=typeof a.ap_min&&p.append("<div>AP: "+BDOcalculator.getItemStat(a,"ap_min",!1,m)+"~"+BDOcalculator.getItemStat(a,"ap_max",!1,m)+"</div>"),"undefined"!=typeof a.dp&&p.append("<div>DP: "+BDOcalculator.getItemStat(a,"dp",!1,m)+"</div>"),p.appendTo(l),l.append('<button class="btn btn-sm btn-primary item-choose" data-enh="'+m+'" data-item="'+r+'" data-itemset="'+i+'" data-type="'+s+'" data-itemno="'+n+'">Choose</button>'),l.append('<div class="item-gems"><strong>Gem Slots:</strong><div>'+a.gems+"</div></div>"),p=$('<div class="item-effects"/>'),p.append("<strong>Item Effects</strong>"),Object.keys(a.item_effects).length>0)for(var f in a.item_effects)a.item_effects.hasOwnProperty(f)&&("special"===f?p.append("<strong>"+BDOdatabase.stats[f].title+":</strong><div>"+a.item_effects.special+"</div>"):p.append("<div>"+BDOdatabase.stats[f].title+" "+BDOcalculator.getItemStat(a,f,!0,m)+BDOdatabase.stats[f].symbol+"</div>"));else p.append("<div>None.</div>");if(p.appendTo(l),p=$('<div class="item-set-effects"/>'),p.append("<strong>Set Effects</strong>"),"undefined"!=typeof BDOdatabase.set_effects[a.set]){if("undefined"!=typeof BDOdatabase.set_effects[a.set].combos)for(var g in BDOdatabase.set_effects[a.set].combos)if(BDOdatabase.set_effects[a.set].combos.hasOwnProperty(g)){var v=BDOdatabase.set_effects[a.set].combos[g],u="";for(var y in v.effects)v.effects.hasOwnProperty(y)&&(u+=(""===u?"<div><span>"+t(v.pieces.join(" + "))+":</span> ":" & ")+BDOdatabase.stats[y].title+" +"+v.effects[y]+BDOdatabase.stats[y].symbol);p.append(u+"</div>")}if("undefined"!=typeof BDOdatabase.set_effects[a.set].pieces)for(var b in BDOdatabase.set_effects[a.set].pieces)if(BDOdatabase.set_effects[a.set].pieces.hasOwnProperty(b)){var O=BDOdatabase.set_effects[a.set].pieces[b],u="";for(var D in O)O.hasOwnProperty(D)&&(u+=(""===u?"<div><span>"+b+"-Pieces:</span> ":" & ")+BDOdatabase.stats[D].title+" +"+O[D]+BDOdatabase.stats[D].symbol);p.append(u+"</div>")}}else p.append("<div>None.</div>");return p.appendTo(l),l.append('<div class="item-enhancement-effects"><strong>Enhancement Effects:</strong><div>'+("undefined"==typeof a.enhancement_text||""===a.enhancement_text?"Info Missing..":a.enhancement_text)+"</div></div>"),l.append('<div class="item-enhancement-level"><strong>Enhancement Level:</strong><input data-slider-min="" data-slider-max="'+e(a)+'" data-slider-value="'+m+'" class="item-enhancement-slider"></div>'),l}var d="";$(document).ready(function(){$("#player-class").on("change",function(){d=$(this).val().toLowerCase(),BDOcalculator.init(),BDOcalculator.calculate(),$(".gear-slot").each(function(e,t){a($(t).attr("data-type"),$(t).attr("data-item"))}),$("#calculator-section").slideDown("fast")}),$("#player-class").select2({width:"100%",data:"undefined"==typeof $("#player-class").attr("placeholder")?BDOdatabase.classes:[$("#player-class").attr("placeholder")].concat(BDOdatabase.classes)}),$("#player-class-section").slideDown(),$(document).on("click",".item-choose",function(){var e=$(this).attr("data-type"),t=$(this).attr("data-itemset"),a="gems"===t?BDOdatabase.gems:BDOdatabase.items[t],i=$(this).attr("data-itemno"),n=$(this).attr("data-enh");$("#gearlist").modal("hide"),"gems"!==t?-1!==$.inArray(e,["main-weapon","secondary-weapon"])&&(a=a[d.toLowerCase()]):a=a[e],a=a[$(this).attr("data-item")],BDOcalculator.setGear(a,e,i,$(this).attr("data-item"),t,function(){s(a,e,i,t),"gems"!==t?BDOcalculator.setEnchantmentLevel(e,i,n,function(){BDOcalculator.calculate()}):BDOcalculator.calculate()})}),$("#equipment .gear-slot").click(function(){var e=$("<div/>"),t=$(this).attr("data-type"),a=$(this).attr("data-itemset"),s=$(this).attr("data-item"),i=BDOdatabase.items[a],r="undefined"==typeof i[d]?i:i[d],o=1;$("#gearlist .modal-body .row").html("");for(var c in r)if(r.hasOwnProperty(c)){var l=r[c],p=!1;-1!==$.inArray(t,["ring","earring"])?BDOcalculator.gear[t+"s"][s].item_name===c&&(p=!0):BDOcalculator.gear[t].item_name===c&&(p=!0),n(l,t,a,s,c,o,p).appendTo("#gearlist .modal-body .row"),o%2===0&&$('<div class="clearfix"></div>').appendTo("#gearlist .modal-body .row"),o++}$(".item-enhancement-slider").each(function(e,t){"0"===$(t).attr("data-slider-max")?$(t).replaceWith("<div>None</div>"):$(t).slider({tooltip_position:"bottom",formatter:function(e){return"+"+e}}).on("change",function(e){var t=$(e.target).closest(".item-details"),a=$(e.target).closest(".item-details").find(".item-choose"),s=a.attr("data-item"),i=a.attr("data-type"),n=a.attr("data-itemset"),r=a.attr("data-itemno"),o=BDOdatabase.items[n],c="undefined"==typeof o[d]?o:o[d];c=c[s],a.attr("data-enh",e.value.newValue);var l=$('<div class="item-effects"/>');if(l.append("<strong>Item Effects</strong>"),Object.keys(c.item_effects).length>0)for(var p in c.item_effects)c.item_effects.hasOwnProperty(p)&&("special"===p?l.append("<strong>"+BDOdatabase.stats[p].title+":</strong><div>"+c.item_effects.special+"</div>"):"boolean"==typeof BDOdatabase.stats[p]?l.append("<div>"+BDOdatabase.stats[p].title+BDOdatabase.stats[p].symbol+"</div>"):l.append("<div>"+BDOdatabase.stats[p].title+" "+BDOcalculator.getItemStat(c,p,!0,e.value.newValue)+BDOdatabase.stats[p].symbol+"</div>"));else l.append("<div>None.</div>");t.find(".item-effects").replaceWith(l),l=$('<div class="item-stats"/>'),"undefined"!=typeof c.ap&&l.append("<div>AP: "+BDOcalculator.getItemStat(c,"ap",!1,e.value.newValue)+"</div>"),"undefined"!=typeof c.ap_min&&l.append("<div>AP: "+BDOcalculator.getItemStat(c,"ap_min",!1,e.value.newValue)+"~"+BDOcalculator.getItemStat(c,"ap_max",!1,e.value.newValue)+"</div>"),"undefined"!=typeof c.dp&&l.append("<div>DP: "+BDOcalculator.getItemStat(c,"dp",!1,e.value.newValue)+"</div>"),t.find(".item-stats").replaceWith(l)})}),$("#gearlist").modal()}),$("#equipment .gem-slot").click(function(){var e=$("<div/>"),t=$(this).attr("data-type"),a=$(this).attr("data-item"),s=BDOdatabase.gems[t],n=1;"undefined"!=typeof s.all&&(s=s.all.concat(s)),$("#gearlist .modal-body .row").html("");for(var d in s)if(s.hasOwnProperty(d)){var r=s[d],o=!1;BDOcalculator.gear[t].gems[a].gem_name===d&&(o=!0),i(r,t,a,d,n,o).appendTo("#gearlist .modal-body .row"),n%2===0&&$('<div class="clearfix"></div>').appendTo("#gearlist .modal-body .row"),n++}$("#gearlist").modal()})})}(jQuery);