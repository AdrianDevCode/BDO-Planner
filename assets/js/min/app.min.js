/*
* @Author: SirMrE
* @http: http://www.sirmre.com/bdo-calculator
* @Copyright: (c) 2016 Mark Eliasen
* @license: May be freely distributed under the CC BY-NC 3.0 License 
*           (https://creativecommons.org/licenses/by-nc/3.0/)
* @Date:   2016-04-07 20:53:22
* @Last Modified by:   SirMrE
* @Last Modified time: 2016-04-15 03:03:08
*/
!function($){"use strict";function e(e){e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i"),t=a.exec(window.location.href);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function a(){var e=[BDOdatabase.classes.indexOf(n(l)),[Object.keys(BDOdatabase.items.helmets).indexOf(BDOcalculator.gear.helmet.item_name),parseInt(BDOcalculator.gear.helmet.enhancement),[Object.keys(BDOdatabase.gems.helmet).indexOf(BDOcalculator.gear.helmet.gems[1].gem_name),Object.keys(BDOdatabase.gems.helmet).indexOf(BDOcalculator.gear.helmet.gems[2].gem_name)]],[Object.keys(BDOdatabase.items.armor).indexOf(BDOcalculator.gear.armor.item_name),parseInt(BDOcalculator.gear.armor.enhancement),[Object.keys(BDOdatabase.gems.armor).indexOf(BDOcalculator.gear.armor.gems[1].gem_name),Object.keys(BDOdatabase.gems.armor).indexOf(BDOcalculator.gear.armor.gems[2].gem_name)]],[Object.keys(BDOdatabase.items.shoes).indexOf(BDOcalculator.gear.shoes.item_name),parseInt(BDOcalculator.gear.shoes.enhancement),[Object.keys(BDOdatabase.gems.shoes).indexOf(BDOcalculator.gear.shoes.gems[1].gem_name),Object.keys(BDOdatabase.gems.shoes).indexOf(BDOcalculator.gear.shoes.gems[2].gem_name)]],[Object.keys(BDOdatabase.items.gloves).indexOf(BDOcalculator.gear.gloves.item_name),parseInt(BDOcalculator.gear.gloves.enhancement),[Object.keys(BDOdatabase.gems.gloves).indexOf(BDOcalculator.gear.gloves.gems[1].gem_name),Object.keys(BDOdatabase.gems.gloves).indexOf(BDOcalculator.gear.gloves.gems[2].gem_name)]],[[Object.keys(BDOdatabase.items.rings).indexOf(BDOcalculator.gear.rings[1].item_name),parseInt(BDOcalculator.gear.rings[1].enhancement)],[Object.keys(BDOdatabase.items.rings).indexOf(BDOcalculator.gear.rings[2].item_name),parseInt(BDOcalculator.gear.rings[2].enhancement)]],[[Object.keys(BDOdatabase.items.earrings).indexOf(BDOcalculator.gear.earrings[1].item_name),parseInt(BDOcalculator.gear.earrings[1].enhancement)],[Object.keys(BDOdatabase.items.earrings).indexOf(BDOcalculator.gear.earrings[2].item_name),parseInt(BDOcalculator.gear.earrings[2].enhancement)]],[Object.keys(BDOdatabase.items.belts).indexOf(BDOcalculator.gear.belt.item_name),parseInt(BDOcalculator.gear.belt.enhancement)],[Object.keys(BDOdatabase.items.necklaces).indexOf(BDOcalculator.gear.necklace.item_name),parseInt(BDOcalculator.gear.necklace.enhancement)],[Object.keys(BDOdatabase.items["main-weapons"]).indexOf(BDOcalculator.gear["main-weapon"].item_name),parseInt(BDOcalculator.gear["main-weapon"].enhancement),[Object.keys(BDOdatabase.gems["main-weapon"]).indexOf(BDOcalculator.gear["main-weapon"].gems[1].gem_name),Object.keys(BDOdatabase.gems["main-weapon"]).indexOf(BDOcalculator.gear["main-weapon"].gems[2].gem_name)]],[Object.keys(BDOdatabase.items["secondary-weapons"]).indexOf(BDOcalculator.gear["secondary-weapon"].item_name),parseInt(BDOcalculator.gear["secondary-weapon"].enhancement),[Object.keys(BDOdatabase.gems["secondary-weapon"]).indexOf(BDOcalculator.gear["secondary-weapon"].gems[1].gem_name),Object.keys(BDOdatabase.gems["secondary-weapon"]).indexOf(BDOcalculator.gear["secondary-weapon"].gems[2].gem_name)]]];$("#share-link").val(window.location.href+(-1===window.location.href.indexOf("?")?"?":"&")+"gear="+JSON.stringify(e))}function t(a){var t=e("gear"),s=["class","helmet","armor","shoes","gloves","rings","earrings","belt","necklace","main-weapon","secondary-weapon"];if(a="undefined"!=typeof a?a:function(e){},null===t)return void a(!1);if(t=JSON.parse(t),-1===$.inArray(n(BDOdatabase.classes[t[0]]),BDOdatabase.classes))return void a(!1);l=BDOdatabase.classes[t[0]],BDOcalculator.init();for(var i=t.length-1,r=1;i>=r;r++){var o=s[r],d=o,m=o+("armor"===o?"":"s"!==o.slice(-1)?"s":""),p=BDOdatabase.items[m],f=Object.keys(p),g="",O;if(-1!==t[r][0])if("rings"===d||"earrings"===d)for(var u=1;u>=0;u--)g=f[t[r][u][0]],""!==g&&"undefined"!=typeof g&&c(g,d.slice(0,-1),d,u+1,t[r][u][1],!1);else{if(g=f[t[r][0]],""===g||"undefined"==typeof g)continue;if(c(g,d,m,O,t[r][1],!1),-1===$.inArray(d,["belt","necklace"])&&t[r][2].length)for(var b=Object.keys(BDOdatabase.gems[d]),u=1;u>=0;u--)g=b[t[r][2][u]],""!==g&&"undefined"!=typeof g&&c(g,d,"gems",u+1,null,!1)}}a(!0)}function s(e){var a=Object.keys(e.enhancement).length;return a>0&&a>BDOdatabase.max_gear_enhancement&&(a=BDOdatabase.max_gear_enhancement),a}function n(e){return e.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()})}function i(e,a){$("#equipment .gear-slot[data-type='"+e+"']"+("undefined"==typeof a?"":"[data-item='"+a+"']")).attr("style",""),$("#equipment .gem-slot."+e+"1, .gem-slot."+e+"2").attr("style","").hide()}function r(e,a,t,s){if(t="undefined"==typeof t?"undefined":t,"gems"!==s?$("#equipment .gear-slot[data-type='"+a+"']"+("undefined"===t?"":"[data-item='"+t+"']")).css({"border-color":BDOdatabase.rarities[e.rarity],background:"url(assets/images/48/"+(-1===$.inArray(a,["main-weapon","secondary-weapon"])?a:BDOdatabase.class_weapons[l][a].replace(" ","-").toLowerCase())+".png) no-repeat center center"}):$("#equipment .gem-slot[data-type='"+a+"'][data-item='"+t+"']").css({"border-color":BDOdatabase.rarities[e.rarity]}),-1!==$.inArray(a,["main-weapon","secondary-weapon","armor","shoes","gloves","helmet"])&&"gems"!==s&&($("#equipment .gem-slot."+a+"1, #equipment .gem-slot."+a+"2").hide(),e.gems>0))for(var n,i=e.gems;i>0;i--)""!==BDOcalculator.gear[a].gems[i].gem_name?(n=BDOcalculator.gear[a].gems[i].gem,$("#equipment .gem-slot."+a+i).css({"border-color":BDOdatabase.rarities[n.rarity]}).show()):$("#equipment .gem-slot."+a+i).attr("style","").show()}function c(e,t,s,n,i,c){var o="gems"===s?BDOdatabase.gems:BDOdatabase.items[s];c="undefined"==typeof c?!0:c,"gems"!==s?-1!==$.inArray(t,["main-weapon","secondary-weapon"])&&(o=o[l.toLowerCase()]):o=o[t],o=o[e],BDOcalculator.setGear(o,t,n,e,s,function(){r(o,t,n,s),"gems"!==s?BDOcalculator.setEnchantmentLevel(t,n,i,function(){c&&BDOcalculator.calculate()}):c&&BDOcalculator.calculate(),c&&a()})}function o(e,a,t,s,n,i){n="undefined"==typeof n?1:n;var r=$('<div class="item-details '+(i?" selected ":"")+"col-md-10 col-md-offset-"+(n%2===0?"2":"1")+'"/>'),c;if(r.append('<div class="item-name"><strong style="color: '+BDOdatabase.rarities[e.rarity]+'">'+s+"</strong></div>"),r.append('<div class="item-icon"><img src="assets/images/48/gem.png" alt="BDO Gear Calculator"></div>'),r.append('<button class="btn btn-sm btn-primary item-choose" data-item="'+s+'" data-itemset="gems" data-type="'+a+'" data-itemno="'+t+'">Choose</button>'),c=$('<div class="item-effects"/>'),c.append("<strong>Item Effects</strong>"),Object.keys(e.item_effects).length>0)for(var o in e.item_effects)e.item_effects.hasOwnProperty(o)&&("special"===o?c.append("<strong>"+BDOdatabase.stats[o].title+":</strong><div>"+e.item_effects.special+"</div>"):c.append("<div>"+BDOdatabase.stats[o].title+" "+e.item_effects[o]+BDOdatabase.stats[o].symbol+"</div>"));else c.append("<div>None.</div>");if(c.appendTo(r),e.incompatible.length>0){c=$('<div class="item-effects"/>'),c.append("<strong>It doesn't stack with:</strong>");for(var d=e.incompatible.length-1;d>=0;d--)c.append("<div>"+e.incompatible[d]+"</div>");c.appendTo(r)}return r}function d(e,a,t,i,r,c,o){c="undefined"==typeof c?1:c;var d=$('<div class="item-details '+(o?" selected ":"")+"col-md-10 col-md-offset-"+(c%2===0?"2":"1")+'"/>'),m,p=0;if(-1!==$.inArray(a,["ring","earring"])?BDOcalculator.gear[a+"s"][i].item_name===r&&(p=BDOcalculator.gear[a+"s"][i].enhancement):BDOcalculator.gear[a].item_name===r&&(p=BDOcalculator.gear[a].enhancement),d.append('<div class="item-name"><strong style="color: '+BDOdatabase.rarities[e.rarity]+'">'+r+"</strong></div>"),d.append('<div class="item-icon"><img src="assets/images/48/'+(-1===$.inArray(a,["main-weapon","secondary-weapon"])?a:BDOdatabase.class_weapons[l][a].replace(" ","-").toLowerCase())+'.png" alt="BDO Gear Calculator"></div>'),m=$('<div class="item-stats"/>'),"undefined"!=typeof e.ap&&m.append("<div>AP: "+BDOcalculator.getItemStat(e,"ap",!1,p)+"</div>"),"undefined"!=typeof e.ap_min&&m.append("<div>AP: "+BDOcalculator.getItemStat(e,"ap_min",!1,p)+"~"+BDOcalculator.getItemStat(e,"ap_max",!1,p)+"</div>"),"undefined"!=typeof e.dp&&m.append("<div>DP: "+BDOcalculator.getItemStat(e,"dp",!1,p)+"</div>"),m.appendTo(d),d.append('<button class="btn btn-sm btn-primary item-choose" data-enh="'+p+'" data-item="'+r+'" data-itemset="'+t+'" data-type="'+a+'" data-itemno="'+i+'">Choose</button>'),d.append('<div class="item-gems"><strong>Gem Slots:</strong><div>'+e.gems+"</div></div>"),m=$('<div class="item-effects"/>'),m.append("<strong>Item Effects</strong>"),Object.keys(e.item_effects).length>0)for(var f in e.item_effects)e.item_effects.hasOwnProperty(f)&&("special"===f?m.append("<strong>"+BDOdatabase.stats[f].title+":</strong><div>"+e.item_effects.special+"</div>"):m.append("<div>"+BDOdatabase.stats[f].title+" "+BDOcalculator.getItemStat(e,f,!0,p)+BDOdatabase.stats[f].symbol+"</div>"));else m.append("<div>None.</div>");if(m.appendTo(d),m=$('<div class="item-set-effects"/>'),m.append("<strong>Set Effects</strong>"),"undefined"!=typeof BDOdatabase.set_effects[e.set]){if("undefined"!=typeof BDOdatabase.set_effects[e.set].combos)for(var g in BDOdatabase.set_effects[e.set].combos)if(BDOdatabase.set_effects[e.set].combos.hasOwnProperty(g)){var O=BDOdatabase.set_effects[e.set].combos[g],u="";for(var b in O.effects)O.effects.hasOwnProperty(b)&&(u+=(""===u?"<div><span>"+n(O.pieces.join(" + "))+":</span> ":" & ")+BDOdatabase.stats[b].title+" +"+O.effects[b]+BDOdatabase.stats[b].symbol);m.append(u+"</div>")}if("undefined"!=typeof BDOdatabase.set_effects[e.set].pieces)for(var D in BDOdatabase.set_effects[e.set].pieces)if(BDOdatabase.set_effects[e.set].pieces.hasOwnProperty(D)){var B=BDOdatabase.set_effects[e.set].pieces[D],u="";for(var v in B)B.hasOwnProperty(v)&&(u+=(""===u?"<div><span>"+D+"-Pieces:</span> ":" & ")+BDOdatabase.stats[v].title+" +"+B[v]+BDOdatabase.stats[v].symbol);m.append(u+"</div>")}}else m.append("<div>None.</div>");return m.appendTo(d),d.append('<div class="item-enhancement-effects"><strong>Enhancement Effects:</strong><div>'+("undefined"==typeof e.enhancement_text||""===e.enhancement_text?"Info Missing..":e.enhancement_text)+"</div></div>"),d.append('<div class="item-enhancement-level"><strong>Enhancement Level:</strong><input data-slider-min="" data-slider-max="'+s(e)+'" data-slider-value="'+p+'" class="item-enhancement-slider"></div>'),d}var l="";$(document).ready(function(){$("#player-class").select2({width:"100%",data:"undefined"==typeof $("#player-class").attr("placeholder")?BDOdatabase.classes:[$("#player-class").attr("placeholder")].concat(BDOdatabase.classes)}),t(function(e){e&&($("#player-class").val(n(l)).trigger("change.select2"),BDOcalculator.calculate(),a(),$("#calculator-section").slideDown("fast"))}),$("#player-class").on("change",function(){l=$(this).val().toLowerCase(),BDOcalculator.init(),BDOcalculator.calculate(),$(".gear-slot").each(function(e,a){i($(a).attr("data-type"),$(a).attr("data-item"))}),$("#calculator-section").slideDown("fast")}),$("#player-class-section").slideDown(),$(document).on("click",".item-choose",function(){var e=$(this).attr("data-type"),a=$(this).attr("data-item"),t=$(this).attr("data-itemset"),s=$(this).attr("data-itemno"),n=$(this).attr("data-enh");$("#gearlist").modal("hide"),c(a,e,t,s,n)}),$("#equipment .gear-slot").click(function(){var e=$("<div/>"),a=$(this).attr("data-type"),t=$(this).attr("data-itemset"),s=$(this).attr("data-item"),n=BDOdatabase.items[t],i="undefined"==typeof n[l]?n:n[l],r=1;$("#gearlist .modal-body .row").html("");for(var c in i)if(i.hasOwnProperty(c)){var o=i[c],m=!1;-1!==$.inArray(a,["ring","earring"])?BDOcalculator.gear[a+"s"][s].item_name===c&&(m=!0):BDOcalculator.gear[a].item_name===c&&(m=!0),d(o,a,t,s,c,r,m).appendTo("#gearlist .modal-body .row"),r%2===0&&$('<div class="clearfix"></div>').appendTo("#gearlist .modal-body .row"),r++}$(".item-enhancement-slider").each(function(e,a){"0"===$(a).attr("data-slider-max")?$(a).replaceWith("<div>None</div>"):$(a).slider({tooltip_position:"bottom",formatter:function(e){return"+"+e}}).on("change",function(e){var a=$(e.target).closest(".item-details"),t=$(e.target).closest(".item-details").find(".item-choose"),s=t.attr("data-item"),n=t.attr("data-type"),i=t.attr("data-itemset"),r=t.attr("data-itemno"),c=BDOdatabase.items[i],o="undefined"==typeof c[l]?c:c[l];o=o[s],t.attr("data-enh",e.value.newValue);var d=$('<div class="item-effects"/>');if(d.append("<strong>Item Effects</strong>"),Object.keys(o.item_effects).length>0)for(var m in o.item_effects)o.item_effects.hasOwnProperty(m)&&("special"===m?d.append("<strong>"+BDOdatabase.stats[m].title+":</strong><div>"+o.item_effects.special+"</div>"):"boolean"==typeof BDOdatabase.stats[m]?d.append("<div>"+BDOdatabase.stats[m].title+BDOdatabase.stats[m].symbol+"</div>"):d.append("<div>"+BDOdatabase.stats[m].title+" "+BDOcalculator.getItemStat(o,m,!0,e.value.newValue)+BDOdatabase.stats[m].symbol+"</div>"));else d.append("<div>None.</div>");a.find(".item-effects").replaceWith(d),d=$('<div class="item-stats"/>'),"undefined"!=typeof o.ap&&d.append("<div>AP: "+BDOcalculator.getItemStat(o,"ap",!1,e.value.newValue)+"</div>"),"undefined"!=typeof o.ap_min&&d.append("<div>AP: "+BDOcalculator.getItemStat(o,"ap_min",!1,e.value.newValue)+"~"+BDOcalculator.getItemStat(o,"ap_max",!1,e.value.newValue)+"</div>"),"undefined"!=typeof o.dp&&d.append("<div>DP: "+BDOcalculator.getItemStat(o,"dp",!1,e.value.newValue)+"</div>"),a.find(".item-stats").replaceWith(d)})}),$("#gearlist").modal()}),$("#equipment .gem-slot").click(function(){var e=$("<div/>"),a=$(this).attr("data-type"),t=$(this).attr("data-item"),s=BDOdatabase.gems[a],n=1;"undefined"!=typeof s.all&&(s=s.all.concat(s)),$("#gearlist .modal-body .row").html("");for(var i in s)if(s.hasOwnProperty(i)){var r=s[i],c=!1;BDOcalculator.gear[a].gems[t].gem_name===i&&(c=!0),o(r,a,t,i,n,c).appendTo("#gearlist .modal-body .row"),n%2===0&&$('<div class="clearfix"></div>').appendTo("#gearlist .modal-body .row"),n++}$("#gearlist").modal()})})}(jQuery);