/*
* @Author: SirMrE
* @http: http://www.sirmre.com/bdo-calculator
* @Copyright: (c) 2016 Mark Eliasen
* @license: May be freely distributed under the CC BY-NC 3.0 License 
*           (https://creativecommons.org/licenses/by-nc/3.0/)
* @Date:   2016-04-07 20:53:22
* @Last Modified by:   SirMrE
* @Last Modified time: 2016-04-11 23:56:22
*/
!function($){"use strict";function e(e){var t=Object.keys(e.enhancement).length;return t>0&&t>BDOdatabase.max_gear_enhancement&&(t=BDOdatabase.max_gear_enhancement),t}function t(e){return e.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()})}function a(e,t){$("#equipment div[data-type='"+e+"']"+("undefined"==typeof t?"":"[data-item='"+t+"']")).attr("style","")}function s(e,t,a){$("#equipment div[data-type='"+t+"']"+("undefined"===a?"":"[data-item='"+a+"']")).css({"border-color":BDOdatabase.rarities[e.rarity],background:"url(assets/images/48/"+(-1===$.inArray(t,["main-weapon","secondary-weapon"])?t:BDOdatabase.class_weapons[i][t].replace(" ","-").toLowerCase())+".png) no-repeat center center"})}function n(a,s,n,d,r,c,o){c="undefined"==typeof c?1:c;var l=$('<div class="item-details '+(o?" selected ":"")+"col-md-10 col-md-offset-"+(c%2===0?"2":"1")+'"/>'),p,f=0;if(-1!==$.inArray(s,["ring","earring"])?BDOcalculator.gear[s+"s"][d].item_name===r&&(f=BDOcalculator.gear[s+"s"][d].enhancement):BDOcalculator.gear[s].item_name===r&&(f=BDOcalculator.gear[s].enhancement),l.append('<div class="item-name"><strong style="color: '+BDOdatabase.rarities[a.rarity]+'">'+r+"</strong></div>"),l.append('<div class="item-icon"><img src="assets/images/48/'+(-1===$.inArray(s,["main-weapon","secondary-weapon"])?s:BDOdatabase.class_weapons[i][s].replace(" ","-").toLowerCase())+'.png" alt="BDO Gear Calculator"></div>'),p=$('<div class="item-stats"/>'),"undefined"!=typeof a.ap&&p.append("<div>AP: "+BDOcalculator.getItemStat(a,"ap",!1,f)+"</div>"),"undefined"!=typeof a.ap_min&&p.append("<div>AP: "+BDOcalculator.getItemStat(a,"ap_min",!1,f)+"~"+BDOcalculator.getItemStat(a,"ap_max",!1,f)+"</div>"),"undefined"!=typeof a.dp&&p.append("<div>DP: "+BDOcalculator.getItemStat(a,"dp",!1,f)+"</div>"),p.appendTo(l),l.append('<button class="btn btn-sm btn-primary item-choose" data-enh="0" data-item="'+r+'" data-itemset="'+n+'" data-type="'+s+'" data-itemno="'+d+'">Choose</button>'),l.append('<div class="item-gems"><strong>Gem Slots:</strong><div>'+a.gems+"</div></div>"),p=$('<div class="item-effects"/>'),p.append("<strong>Item Effects</strong>"),Object.keys(a.item_effects).length>0)for(var m in a.item_effects)a.item_effects.hasOwnProperty(m)&&("special"===m?p.append("<strong>"+BDOdatabase.stats[m].title+":</strong><div>"+a.item_effects.special+"</div>"):p.append("<div>"+BDOdatabase.stats[m].title+" "+BDOcalculator.getItemStat(a,m,!0,f)+BDOdatabase.stats[m].symbol+"</div>"));else p.append("<div>None.</div>");if(p.appendTo(l),p=$('<div class="item-set-effects"/>'),p.append("<strong>Set Effects</strong>"),"undefined"!=typeof BDOdatabase.set_effects[a.set]){var v="";if("undefined"!=typeof BDOdatabase.set_effects[a.set].combos)for(var u in BDOdatabase.set_effects[a.set].combos)if(BDOdatabase.set_effects[a.set].combos.hasOwnProperty(u)){var g=BDOdatabase.set_effects[a.set].combos[u];for(var O in g.effects)g.effects.hasOwnProperty(O)&&(v+=(""===v?"<div><span>"+t(g.pieces.join(" + "))+":</span> ":" & ")+BDOdatabase.stats[O].title+" +"+g.effects[O]+BDOdatabase.stats[O].symbol);p.append(v+"</div>")}if("undefined"!=typeof BDOdatabase.set_effects[a.set].pieces)for(var y in BDOdatabase.set_effects[a.set].pieces)if(BDOdatabase.set_effects[a.set].pieces.hasOwnProperty(y)){var D=BDOdatabase.set_effects[a.set].pieces[y];v="";for(var b in D)D.hasOwnProperty(b)&&(v+=(""===v?"<div><span>"+y+"-Pieces:</span> ":" & ")+BDOdatabase.stats[b].title+" +"+D[b]+BDOdatabase.stats[b].symbol);p.append(v+"</div>")}}else p.append("<div>None.</div>");return p.appendTo(l),l.append('<div class="item-enhancement-effects"><strong>Enhancement Effects:</strong><div>'+("undefined"==typeof a.enhancement_effects?"Info Missing..":a.enhancement_effects)+"</div></div>"),l.append('<div class="item-enhancement-level"><strong>Enhancement Level:</strong><input data-slider-min="" data-slider-max="'+e(a)+'" data-slider-value="'+f+'" class="item-enhancement-slider"></div>'),l}var i="";$(document).ready(function(){$("#player-class").on("change",function(){i=$(this).val().toLowerCase(),BDOcalculator.init(),BDOcalculator.calculate(),$(".gear-slot").each(function(e,t){a($(t).attr("data-type"),$(t).attr("data-item"))}),$("#calculator-section").slideDown("fast")}),$("#player-class").select2({width:"100%",data:"undefined"==typeof $("#player-class").attr("placeholder")?BDOdatabase.classes:[$("#player-class").attr("placeholder")].concat(BDOdatabase.classes)}),$("#player-class-section").slideDown(),$(document).on("click",".item-choose",function(){var e=$(this).attr("data-type"),t=$(this).attr("data-itemset"),a=BDOdatabase.items[t],n=$(this).attr("data-itemno"),d=$(this).attr("data-enh");$("#gearlist").modal("hide"),-1!==$.inArray(e,["main-weapon","secondary-weapon"])&&(a=a[i.toLowerCase()]),a=a[$(this).attr("data-item")],s(a,e,n),BDOcalculator.setGear(a,e,n,$(this).attr("data-item"),function(){BDOcalculator.setEnchantmentLevel(e,n,d,function(){BDOcalculator.calculate()})})}),$("#equipment .gear-slot").click(function(){var e=$("<div/>"),t=$(this).attr("data-type"),a=$(this).attr("data-itemset"),s=$(this).attr("data-item"),d=BDOdatabase.items[a],r="undefined"==typeof d[i]?d:d[i],c=1;"undefined"!=typeof d.all&&(r=r.concat(d.all)),$("#gearlist .modal-body .row").html("");for(var o in r)if(r.hasOwnProperty(o)){var l=r[o],p=!1;-1!==$.inArray(t,["ring","earring"])?BDOcalculator.gear[t+"s"][s].item_name===o&&(p=!0):BDOcalculator.gear[t].item_name===o&&(p=!0),n(l,t,a,s,o,c,p).appendTo("#gearlist .modal-body .row"),c%2===0&&$('<div class="clearfix"></div>').appendTo("#gearlist .modal-body .row"),c++}$(".item-enhancement-slider").each(function(e,t){"0"===$(t).attr("data-slider-max")?$(t).replaceWith("<div>None</div>"):$(t).slider({tooltip_position:"bottom",formatter:function(e){return"+"+e}}).on("slideStop",function(e){var t=$(e.target).closest(".item-details"),a=$(e.target).closest(".item-details").find(".item-choose"),s=a.attr("data-item"),n=a.attr("data-type"),d=a.attr("data-itemset"),r=a.attr("data-itemno"),c=BDOdatabase.items[d],o="undefined"==typeof c[i]?c:c[i];o=o[s],a.attr("data-enh",e.value);var l=$('<div class="item-effects"/>');if(l.append("<strong>Item Effects</strong>"),Object.keys(o.item_effects).length>0)for(var p in o.item_effects)o.item_effects.hasOwnProperty(p)&&("special"===p?l.append("<strong>"+BDOdatabase.stats[p].title+":</strong><div>"+o.item_effects.special+"</div>"):l.append("<div>"+BDOdatabase.stats[p].title+" "+BDOcalculator.getItemStat(o,p,!0,e.value)+BDOdatabase.stats[p].symbol+"</div>"));else l.append("<div>None.</div>");t.find(".item-effects").replaceWith(l),l=$('<div class="item-stats"/>'),"undefined"!=typeof o.ap&&l.append("<div>AP: "+BDOcalculator.getItemStat(o,"ap",!1,e.value)+"</div>"),"undefined"!=typeof o.ap_min&&l.append("<div>AP: "+BDOcalculator.getItemStat(o,"ap_min",!1,e.value)+"~"+BDOcalculator.getItemStat(o,"ap_max",!1,e.value)+"</div>"),"undefined"!=typeof o.dp&&l.append("<div>DP: "+BDOcalculator.getItemStat(o,"dp",!1,e.value)+"</div>"),t.find(".item-stats").replaceWith(l)})}),$("#gearlist").modal()})})}(jQuery);